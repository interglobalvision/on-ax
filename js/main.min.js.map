{"version":3,"sources":["main.js"],"names":["l","data","console","log","detectSpecs","container","document","querySelector","prompt","info","title","style","opacity","hasWebgl","window","WebGLRenderingContext","createElement","getContext","e","hasGetUserMedia","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","innerHTML","init","onselectstart","classList","add","params","WCMParams","gui","dat","GUI","name","onChange","onParamsChange","close","domElement","display","scene","THREE","Scene","camera","PerspectiveCamera","fov","innerWidth","innerHeight","target","Vector3","position","z","video","width","vidWidth","height","vidHeight","preload","loop","URL","webkitURL","stream","webcamOn","src","createObjectURL","remove","threeReady","error","webmSource","type","mp4Source","appendChild","addEventListener","play","videoTexture","Texture","world3D","Object3D","geometry","PlaneGeometry","canvasWidth","canvasHeight","dynamic","meshMaterial","MeshBasicMaterial","map","wireMaterial","color","wireframe","blending","AdditiveBlending","transparent","wireframeLinejoin","wiremirror","Mesh","renderer","WebGLRenderer","antialias","sortObjects","setSize","vidCanvas","body","ctx","onMouseMove","onResize","onWheel","self","top","isIframe","showInfo","getElementById","hideInfo","event","animate","this","zoom","mOpac","wfOpac","contrast","saturation","invertZ","zDepth","noiseStrength","noiseScale","noiseSpeed","webkitFilter","getZDepths","noisePosn","arpPlayer","isPlaying","noiseData","getAnalyserData","noiseBass","noiseMed","noiseHigh","drawImage","pixels","getImageData","i","j","Color","getColor","brightness","getBrightness","gotoZ","perlin","noise","vertices","verticesNeedUpdate","mouseX","clientX","windowHalfX","mouseY","clientY","windowHalfY","readyState","HAVE_ENOUGH_DATA","needsUpdate","requestAnimationFrame","render","time","scale","rotation","x","tiltAmount","tiltSpeed","y","aspect","updateProjectionMatrix","base","Math","floor","c","r","g","b","a","preventDefault","wheelDelta","max","min","__controllers","updateDisplay","saveImage","open","toDataURL","controls","stats","ImprovedNoise","musicNoise","CLIENT_ID","audioContext","sourceNode","audioPlayer","analyserNode","dataArray","soundBuffer","isReady","bpmCounter","_this","setBodySize","pause","AudioContext","webkitAudioContext","createMediaElementSource","createAnalyser","fftSize","Uint8Array","frequencyBinCount","connect","destination","buffer","paused","setInterval","currentTime","clearInterval","getByteTimeDomainData","$","ready","intervalId","load"],"mappings":"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","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Modernizr, THREE */\n\nfunction l(data) {\n  'use strict';\n  console.log(data);\n}\n\ndocument.body.style.width = window.innerWidth + \"px\";\ndocument.body.style.height = window.innerHeight + \"px\";\n\nnavigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n\n// GLOBALS \nvar container, scene, camera, renderer, controls, stats, videoTexture;\n\n/**\n *\n * WebCam Mesh by Felix Turner\n * @felixturner / www.airtight.cc\n * (c) Airtight Interactive Inc. 2012\n *\n * Connects HTML5 WebCam input to a WebGL 3D Mesh. It creates a 3D depth map by mapping pixel brightness to Z-depth.\n * Perlin noise is used for the ripple effect and CSS3 filters are used for color effects.\n * Use mouse move to tilt and scroll wheel to zoom. Requires Chrome or Opera.\n *\n */\nvar fov = 70;\nvar canvasWidth = 320 / 2;\nvar canvasHeight = 240 / 2;\nvar vidWidth = 1280;\nvar vidHeight = 960;\nvar tiltSpeed = 0.2;\nvar tiltAmount = 0.1;\n\nvar perlin = new ImprovedNoise();\nvar camera, scene, renderer;\nvar mouseX = 0;\nvar mouseY = 0;\nvar windowHalfX, windowHalfY;\nvar video, videoTexture;\nvar world3D;\nvar geometry;\nvar vidCanvas;\nvar ctx;\nvar pixels;\nvar noisePosn = 0;\nvar wireMaterial;\nvar meshMaterial;\nvar container;\nvar params;\nvar title, info, prompt;\n\nvar time = 0.0;\n\nvar gui;\n\nvar musicNoise;\n\nvar threeReady = false;\n\nvar webcamOn = false;\nvar isIframe = false;\n\nfunction detectSpecs() {\n\n  //init HTML elements\n  container = document.querySelector('#threeContainer');\n  prompt = document.querySelector('#prompt');\n  info = document.querySelector('#info');\n  title = document.querySelector('#title');\n  container.style.opacity = 0;\n\n  var hasWebgl = (function() {\n    try {\n      return !!window.WebGLRenderingContext && !! document.createElement('canvas').getContext('experimental-webgl');\n    } catch (e) {\n      return false;\n    }\n  })();\n\n  var hasGetUserMedia = (function() {\n    return !!(navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);\n  })();\n\n  //console.log(\"hasWebGL: \" + hasWebgl);\n  //console.log(\"hasGetUserMedia: \" + hasGetUserMedia);\n  if (!hasGetUserMedia) {\n    prompt.innerHTML = 'This demo requires webcam support (Chrome or Opera).';\n  } else if (!hasWebgl) {\n    prompt.innerHTML = 'No WebGL support detected. Please try restarting the browser.';\n  } else {\n    prompt.innerHTML = 'To enjoy the full experience allow camera access';\n    init();\n  }\n\n}\n\nfunction init() {\n\n  // stop the user getting a text cursor\n  document.onselectstart = function() {\n    return false;\n  };\n\n  prompt.classList.add('active');\n  //init control panel\n  params = new WCMParams();\n  gui = new dat.GUI();\n  gui.add(params, 'zoom', 0.1, 5).name('Zoom').onChange(onParamsChange);\n  gui.add(params, 'mOpac', 0, 1).name('Mesh Opacity').onChange(onParamsChange);\n  gui.add(params, 'wfOpac', 0, 0.5).name('Grid Opacity').onChange(onParamsChange);\n  gui.add(params, 'contrast', 1, 5).name('Contrast').onChange(onParamsChange);\n  gui.add(params, 'saturation', 0, 2).name('Saturation').onChange(onParamsChange);\n  gui.add(params, 'zDepth', 0, 1000).name('Z Depth');\n  gui.add(params, 'noiseStrength', 0, 60).name('Noise Strength');\n  gui.add(params, 'noiseSpeed', 0, 0.05).name('Noise Speed');\n  gui.add(params, 'noiseScale', 0, 1).name('Noise Scale');\n  gui.add(params, 'invertZ').name('Invert Z');\n  //gui.add(this, 'saveImage').name('Snapshot');\n  gui.close();\n  gui.domElement.style.display = 'none';\n\n  //Init 3D\n  scene = new THREE.Scene();\n  camera = new THREE.PerspectiveCamera(fov, window.innerWidth / window.innerHeight, 1, 5000);\n  camera.target = new THREE.Vector3(0, 0, 0);\n  scene.add(camera);\n  camera.position.z = 300;\n\n  //init webcam texture\n  video = document.createElement('video');\n  video.width = vidWidth;\n  video.height = vidHeight;\n  video.preload = 'auto';\n  video.loop = true;\n\n  //make it cross browser\n  window.URL= window.URL || window.webkitURL;\n  navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n  //get webcam\n  navigator.getUserMedia({\n    video: true\n  }, function(stream) {\n    //on webcam enabled\n    webcamOn = true;\n    video.src = window.URL.createObjectURL(stream);\n    prompt.classList.remove('active');\n    gui.domElement.style.display = 'inline';\n    threeReady = true;\n    console.log('Three is ready');\n  }, function(error) {\n    var webmSource = document.createElement('source');\n    webmSource.src = \"vid/bg.webm\";\n    webmSource.type = 'video/webm; codecs=\"vp8, vorbis\"';\n\n    var mp4Source = document.createElement('source');\n    mp4Source.src = 'vid/bg.mp4';\n    mp4Source.type = 'video/mp4; codecs=\"avc1.42E01E, mp4a.40.2\"';\n\n    video.appendChild(webmSource);\n    video.appendChild(mp4Source);\n\n    video.addEventListener('canplay', function() {\n      video.play();\n      prompt.classList.remove('active');\n      gui.domElement.style.display = 'inline';\n      //params.noiseScale = 0.05;\n      threeReady = true;\n      console.log('Three is ready');\n    });\n  });\n\n  videoTexture = new THREE.Texture(video);\n\n  world3D = new THREE.Object3D();\n  scene.add(world3D);\n\n  //add mirror plane\n  geometry = new THREE.PlaneGeometry(640, 480, canvasWidth, canvasHeight);\n  geometry.dynamic = true;\n  meshMaterial = new THREE.MeshBasicMaterial({\n    opacity: 1,\n    map: videoTexture\n  });\n\n  /*\n     var mirror = new THREE.Mesh(geometry, meshMaterial);\n     world3D.add(mirror);\n     */\n\n  /*\n  var coverTexture = THREE.ImageUtils.loadTexture( \"img/texture.png\" );\n  coverTexture.wrapS = THREE.RepeatWrapping;\n  coverTexture.wrapT = THREE.RepeatWrapping;\n  */\n  //add wireframe plane\n  wireMaterial = new THREE.MeshBasicMaterial({\n    opacity: 0.15,\n    color: 0x7667c1,\n    wireframe: true,\n    //alphaMap: coverTexture,\n    blending: THREE.AdditiveBlending,\n    transparent: true,\n    wireframeLinejoin: \"round\"\n  });\n  var wiremirror = new THREE.Mesh(geometry, wireMaterial);\n  world3D.add(wiremirror);\n  wiremirror.position.z = 9;\n\n\n  //init renderer\n  renderer = new THREE.WebGLRenderer({\n    antialias: true\n  });\n  renderer.sortObjects = false;\n  renderer.setSize(window.innerWidth, window.innerHeight);\n  container.appendChild(renderer.domElement);\n\n  /*\n  // add Stats\n  stats = new Stats();\n  document.querySelector('.fps').appendChild(stats.domElement);\n  */\n\n  //init vidCanvas - used to analyze the video pixels\n  vidCanvas = document.createElement('canvas');\n  document.body.appendChild(vidCanvas);\n  vidCanvas.style.position = 'absolute';\n  vidCanvas.style.display = 'none';\n  ctx = vidCanvas.getContext('2d');\n\n  //init listeners\n  document.addEventListener('mousemove', onMouseMove, false);\n  window.addEventListener('resize', onResize, false);\n  document.addEventListener('mousewheel', onWheel, false);\n\n  // If in iframe, dont show info\n  if( window.self === window.top ) {\n    isIframe = true;\n    container.addEventListener('click', showInfo, false);\n    document.getElementById(\"closeBtn\").addEventListener('click', hideInfo, false);\n    title.addEventListener('click', showInfo, false);\n\n  }\n\n  //handle WebGL context lost\n  renderer.domElement.addEventListener(\"webglcontextlost\", function(event) {\n    prompt.style.display = 'inline';\n    prompt.classList.add('active');\n    prompt.innerHTML = 'WebGL Context Lost. Please try reloading the page.';\n  }, false);\n\n  onResize();\n\n  animate();\n\n}\n\n// params for dat.gui\n\nfunction WCMParams() {\n  this.zoom = 1.1;\n  this.mOpac = 0;\n  this.wfOpac = 0.2;\n  this.contrast = 2;\n  this.saturation = 1.1;\n  this.invertZ = true;\n  this.zDepth = 100;\n  this.noiseStrength = 91;\n  this.noiseScale = 0.01;\n  this.noiseSpeed = 0.0002;\n  //this.doSnapshot = function() {};\n}\n\nfunction onParamsChange() {\n  meshMaterial.opacity = params.mOpac;\n  wireMaterial.opacity = params.wfOpac;\n  container.style.webkitFilter = \"contrast(\" + params.contrast + \") saturate(\" + params.saturation + \")\";\n}\n\nfunction getZDepths() {\n\n  noisePosn += params.noiseSpeed;\n  if( arpPlayer.isPlaying ) {\n    var noiseData = arpPlayer.getAnalyserData();\n  } else {\n    var noiseData =  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];\n  }\n  var noiseBass = noiseData[2] / 64.0;\n  noiseBass += noiseData[3] / 64.0;\n\n  var noiseMed = noiseData[8] / 128.0;\n  var noiseHigh = noiseData[11] / 128.0;\n\n  var noiseScale = params.noiseScale + ( noiseBass / 10000 );\n\n  var noiseStrength = params.noiseStrength;\n\n  var zDepth = params.zDepth * noiseHigh;\n\n  //draw webcam video pixels to canvas for pixel analysis\n  //double up on last pixel get because there is one more vert than pixels\n  ctx.drawImage(video, 0, 0, canvasWidth + 1, canvasHeight + 1);\n  pixels = ctx.getImageData(0, 0, canvasWidth + 1, canvasHeight + 1).data;\n\n  for (var i = 0; i < canvasWidth + 1; i++) {\n    for (var j = 0; j < canvasHeight + 1; j++) {\n      var color = new THREE.Color(getColor(i, j));\n      var brightness = getBrightness(color);\n      var gotoZ = zDepth * brightness - zDepth / 1.3;\n\n      //add 32 wobble\n      gotoZ += perlin.noise(i * noiseScale, j * noiseScale, noiseMed) * noiseStrength;\n      gotoZ = gotoZ * noiseHigh;\n      //gotoZ += perlin.noise(i * params.noiseScale, j * params.noiseScale, noiseBass) * params.noiseStrength;\n      //gotoZ += perlin.noise(i * params.noiseScale, j * params.noiseScale, noisePosn) * params.noiseStrength;\n      //invert?\n      if (params.invertZ) gotoZ = -gotoZ;\n      //tween to stablize\n      geometry.vertices[j * (canvasWidth + 1) + i].z += (gotoZ - geometry.vertices[j * (canvasWidth + 1) + i].z) / 5;\n    }\n  }\n  geometry.verticesNeedUpdate = true;\n}\n\nfunction onMouseMove(event) {\n  if( webcamOn ) {\n    mouseX = (event.clientX - windowHalfX) / (windowHalfX);\n    mouseY = (event.clientY - windowHalfY) / (windowHalfY);\n  } else {\n    mouseX = (event.clientX - windowHalfX) * 20  / (windowHalfX);\n    mouseY = (event.clientY - windowHalfY) * 20  / (windowHalfY);\n  }\n}\n\nfunction animate() {\n  if (video.readyState === video.HAVE_ENOUGH_DATA) {\n    videoTexture.needsUpdate = true;\n    getZDepths();\n  }\n  //console.log( arpPlayer.getAnalyserData() );\n  //stats.update();\n  requestAnimationFrame(animate);\n  render();\n}\n\nfunction render() {\n  time+=0.01;\n  world3D.scale = new THREE.Vector3(params.zoom, params.zoom, 1);\n  world3D.rotation.x += ((mouseY * tiltAmount) - world3D.rotation.x) * tiltSpeed;\n  world3D.rotation.y += ((mouseX * tiltAmount) - world3D.rotation.y) * tiltSpeed;\n  //camera.lookAt(camera.target);\n  renderer.render(scene, camera);\n}\n\nfunction onResize() {\n  renderer.setSize(window.innerWidth, window.innerHeight);\n  camera.aspect = window.innerWidth / window.innerHeight;\n  camera.updateProjectionMatrix();\n  windowHalfX = window.innerWidth / 2;\n  windowHalfY = window.innerHeight / 2;\n}\n\n// Returns a hexidecimal color for a given pixel in the pixel array.\n\nfunction getColor(x, y) {\n  var base = (Math.floor(y) * (canvasWidth + 1) + Math.floor(x)) * 4;\n  var c = {\n    r: pixels[base + 0],\n    g: pixels[base + 1],\n    b: pixels[base + 2],\n    a: pixels[base + 3]\n  };\n  return (c.r << 16) + (c.g << 8) + c.b;\n}\n\n//return pixel brightness between 0 and 1 based on human perceptual bias\n\nfunction getBrightness(c) {\n  return (0.34 * c.r + 0.5 * c.g + 0.16 * c.b);\n}\n\nfunction hideInfo(e) {\n  e.preventDefault();\n  info.classList.remove('active');\n  if( !arpPlayer.isPlaying ) {\n    document.getElementById(\"playPlayer\").classList.add('active');\n  }\n}\n\nfunction showInfo(e) {\n  e.preventDefault();\n  info.classList.add('active');\n  document.getElementById(\"playPlayer\").classList.remove('active');\n}\n\nfunction onWheel(event) {\n\n  params.zoom += event.wheelDelta * 0.002;\n  //limit\n  params.zoom = Math.max(params.zoom, 0.1);\n  params.zoom = Math.min(params.zoom, 5);\n\n  //update gui slider\n  gui.__controllers[0].updateDisplay();\n}\n\nfunction saveImage() {\n  render();\n  window.open(renderer.domElement.toDataURL(\"image/png\"));\n}\n\n/*\n *\n *\n *\n *  AUDIO STUFF\n *\n *\n *\n *  ////////////////////////////////////////////////////////////////\n */\n\n/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Modernizr */\n\nfunction l(data) {\n  'use strict';\n  console.log(data);\n}\nCLIENT_ID = '1af5bd17adc32f47529ce064b5e03361';\n\nvar arpPlayer = {\n  audioContext: '',\n  sourceNode: '',\n  audioPlayer: null,\n  analyserNode: null,\n  dataArray: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n  soundBuffer: null,\n  isReady: false,\n  isPlaying: false,\n  bpmCounter: null,\n  init: function() {\n    l('init');\n    var _this = this;\n\n    _this.setBodySize();\n    window.addEventListener('resize', _this.setBodySize, false);\n    document.getElementById(\"pause-btn\").addEventListener('click', function(e) {\n      e.preventDefault();\n      if( arpPlayer.isPlaying === true ) {\n        arpPlayer.pause();\n      }\n    });\n    document.getElementById(\"play-btn\").addEventListener('click', function(e) {\n      e.preventDefault();\n      if( arpPlayer.isPlaying === false ) {\n        arpPlayer.play();\n      }\n\n    });\n\n    // Set audio context\n    _this.audioContext = new (window.AudioContext || window.webkitAudioContext);\n\n    // Set audio player\n    _this.audioPlayer = document.getElementById('audioPlayer');\n\n    // Stop if is playing\n    if( _this.isPlaying ) {\n      _this.pause();\n    }\n\n    _this.audioPlayer.addEventListener('canplay', function() {\n\n      // Create media element source\n      _this.sourceNode = _this.audioContext.createMediaElementSource( _this.audioPlayer );\n\n      // Create a analyser node\n      _this.analyserNode = _this.audioContext.createAnalyser();\n      _this.analyserNode.fftSize = 32;\n      _this.dataArray = new Uint8Array(_this.analyserNode.frequencyBinCount);\n\n      // Connect source with audio destination\n      _this.sourceNode.connect(_this.analyserNode);       // connect the source to the context's destination (the speakers)\n      _this.analyserNode.connect(_this.audioContext.destination);       // connect the source to the context's destination (the speakers)\n      _this.sourceNode.buffer = _this.soundBuffer;                    // tell the source which sound to play\n      \n\n      _this.isReady = true;\n      console.log('Player is ready');\n\n    });\n\n    /*\n       var request = new XMLHttpRequest();\n       request.open('GET', streamUrl, true);\n       request.responseType = 'arraybuffer';\n\n       request.onload = function() {\n       _this.audioContext.decodeAudioData(request.response, function(buffer) {\n       _this.soundBuffer = buffer;\n       _this.isReady = true;\n    //_this.play();\n    }, function(err) {\n    console.log(err);\n    });\n    }\n\n    request.send(); \n    */\n\n    detectSpecs();\n\n  },\n  play: function() {\n    var _this = this;\n\n    // Check if video is paused\n    if ( video.paused ) {\n      video.play();\n    }\n\n    // Set bpm counter interval\n    // BPM: 124\n    _this.bpmCounter = setInterval( function() {\n      var time = _this.audioPlayer.currentTime;\n      \n      // Show info in 5 sec\n      if( time > 8 && time < 9 && isIframe ) {\n        info.classList.add('active');\n        document.getElementById(\"playPlayer\").classList.remove('active');\n      }\n\n      // Animation effects\n      if( time > 0 && time < 0.484 ) {\n        if( !webcamOn ) {\n          params.invertZ = false;\n        }\n      }\n      if( time > 13.552 && time < 14.52 ) {\n        params.invertZ = true;\n        params.noiseScale = 0.01;\n      }\n      \n      if( time > 60.016 && time < 60.984 ) {\n        if( !webcamOn ) {\n          params.invertZ = false;\n        } else {\n          video.pause();\n        }\n        params.noiseScale = 0.05;\n      }\n      if( time > 75.504 && time < 76.472 ) {\n        params.invertZ = true;\n        if( webcamOn ) {\n          video.play();\n        }\n      }\n\n      if( time > 85.184 && time < 86.152 ) {\n        params.noiseScale = 0.01;\n      }\n\n      if( time > 185.856 && time < 186.824 ) {\n        params.invertZ = false;\n        params.zDepth = 150;\n        params.noiseScale = 0.05;\n      }\n      if( time > 197.472 && time < 198.44 ) {\n        params.invertZ = true;\n        params.zDepth = 100;\n        params.noiseScale = 0.01;\n      }\n\n    }, 242);\n\n    // Play track\n    _this.audioPlayer.play();\n\n    // fade In animation\n    container.style.opacity = 1;\n    document.getElementById(\"pausePlayer\").classList.add('active');\n    document.getElementById(\"playPlayer\").classList.remove('active');\n\n    _this.isPlaying = true;\n\n  },\n  pause: function() {\n    var _this = this;\n\n    container.style.opacity = 0;\n    clearInterval( _this.bpmCounter );\n    _this.audioPlayer.pause();\n    video.pause();\n    _this.isPlaying = false;\n    document.getElementById(\"pausePlayer\").classList.remove('active');\n    if( document.getElementById('info').classList == false ) {\n      document.getElementById(\"playPlayer\").classList.add('active');\n    }\n  },\n  getAnalyserData: function() {\n    var _this = this;\n\n    _this.analyserNode.getByteTimeDomainData(_this.dataArray);\n    return _this.dataArray;\n  },\n  setBodySize: function() {\n    document.body.style.width = window.innerWidth + \"px\";\n    document.body.style.height = window.innerHeight + \"px\";\n  },\n};\n\n$(document).ready(function () {\n  'use strict';\n\n  arpPlayer.init();\n\n  // Set interval checker\n  var intervalId = setInterval( function() {\n    if( arpPlayer.isReady == true && threeReady == true ) {\n      // Set controls\n      document.getElementById(\"playPlayer\").classList.add('active');\n      clearInterval( intervalId );\n    }\n  }, 300);\n\n});\n\n$(window).load(function () {\n});\n\n"]}